<% layout("/layout/boilerplate.ejs") -%>
    <!DOCTYPE html>

    <html class="dark" lang="en">

    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>ClassLoop | Connection Requests</title>
        <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
            rel="stylesheet" />
        <link
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
            rel="stylesheet" />
        <link
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
            rel="stylesheet" />
        <script id="tailwind-config">
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            "primary": "#9f1fef",
                            "background-light": "#f7f6f8",
                            "background-dark": "#120a17",
                            "card-dark": "#1e1128",
                            "glass-dark": "rgba(58, 35, 72, 0.4)",
                        },
                        fontFamily: {
                            "display": ["Inter", "sans-serif"]
                        },
                        borderRadius: {
                            "DEFAULT": "0.5rem",
                            "lg": "1rem",
                            "xl": "1.5rem",
                            "full": "9999px"
                        },
                    },
                },
            }
        </script>
        <style>
            body {
                font-family: 'Inter', sans-serif;
            }

            .glass-morphism {
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
            }

            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }

            .material-symbols-fill {
                font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
        </style>
    </head>

    <body class="bg-background-light dark:bg-background-dark min-h-screen text-slate-900 dark:text-slate-100">

        <main class="max-w-[1380px] mx-auto px-2 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                <!-- Left Sidebar: Profile Summary -->
                <aside class="lg:col-span-3 space-y-4">
                    <div
                        class="bg-white dark:bg-card-dark rounded-xl overflow-hidden shadow-sm border border-black/5 dark:border-white/5">
                        <div class="h-16 bg-gradient-to-r from-primary to-purple-800"
                            data-alt="Abstract gradient background banner"></div>
                        <div class="px-5 pb-6 -mt-8">
                            <div
                                class="h-20 w-20 rounded-2xl border-4 border-background-light dark:border-card-dark overflow-hidden mb-3 shadow-lg">
                                <img class="h-full w-full object-cover" data-alt="Student profile avatar"
                                    src="<%=currUser.profilePic.url%>" />
                            </div>
                            <h3 class="text-lg font-bold dark:text-white leading-tight">
                                <%=currUser.name%>
                            </h3>
                            <p class="text-sm text-slate-500 dark:text-slate-400 font-medium">IIT Delhi, Computer
                                Science
                            </p>
                            <div class="mt-4 pt-4 border-t border-slate-100 dark:border-white/5 space-y-3">
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-400">Profile Views</span>
                                    <span class="font-bold text-primary">0</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="text-slate-400">Post Impressions</span>
                                    <span class="font-bold text-primary">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div
                        class="bg-white dark:bg-card-dark rounded-xl p-2 shadow-sm border border-black/5 dark:border-white/5">
                        <nav class="space-y-2">
                            <a href="/user/sync-requests?tab=received"
                                class="flex items-center justify-between px-4 py-3 rounded-xl transition-all font-semibold text-sm 
       <%= activeTab === 'received' ? 'bg-primary/10 text-primary border-l-4 border-primary' : 'text-slate-400 hover:bg-white/5 border-l-4 border-transparent' %>">
                                <div class="flex items-center gap-3">
                                    <span
                                        class="material-symbols-outlined <%= activeTab === 'received' ? 'material-symbols-fill' : '' %>">download</span>
                                    <span>Received</span>
                                </div>
                                <span class="bg-primary/20 text-[10px] py-0.5 px-2 rounded-full">
                                    <%= receivedRequests.length %>
                                </span>
                            </a>

                            <a href="/user/sync-requests?tab=sent"
                                class="flex items-center justify-between px-4 py-3 rounded-xl transition-all font-semibold text-sm 
       <%= activeTab === 'sent' ? 'bg-primary/10 text-primary border-l-4 border-primary' : 'text-slate-400 hover:bg-white/5 border-l-4 border-transparent' %>">
                                <div class="flex items-center gap-3">
                                    <span
                                        class="material-symbols-outlined <%= activeTab === 'sent' ? 'material-symbols-fill' : '' %>">send</span>
                                    <span>Sent</span>
                                </div>
                                <span class="bg-white/10 text-[10px] py-0.5 px-2 rounded-full text-white/60">
                                    <%= sentRequests.length %>
                                </span>
                            </a>

                            <a href="/user/sync-requests?tab=network"
                                class="flex items-center justify-between px-4 py-3 rounded-xl transition-all font-semibold text-sm 
       <%= activeTab === 'network' ? 'bg-primary/10 text-primary border-l-4 border-primary' : 'text-slate-400 hover:bg-white/5 border-l-4 border-transparent' %>">
                                <div class="flex items-center gap-3">
                                    <span
                                        class="material-symbols-outlined <%= activeTab === 'network' ? 'material-symbols-fill' : '' %>">diversity_3</span>
                                    <span>My Network</span>
                                </div>
                                <span class="bg-white/10 text-[10px] py-0.5 px-2 rounded-full text-white/60">
                                    <%= myNetwork.length %>
                                </span>
                            </a>
                        </nav>
                    </div>
                    <button
                        class="w-full flex items-center justify-center gap-2 py-3 bg-white/5 hover:bg-white/10 text-white rounded-xl border border-white/5 transition-all group">
                        <span
                            class="material-symbols-outlined text-sm group-hover:-translate-x-1 transition-transform">arrow_back</span>
                        <span class="text-sm font-bold tracking-tight">Back to Home</span>
                    </button>
                </aside>
                <!-- Main Content: Pending Requests -->
                <section class="lg:col-span-6 space-y-6">
                    <!-- Page Heading -->
                    <div class="flex flex-col gap-1 px-2">
                        <h1 class="text-3xl font-black tracking-tight dark:text-white">Connection Requests</h1>
                        <p class="text-slate-500 dark:text-slate-400">Manage your incoming and outgoing networking loops
                        </p>
                    </div>
                    <!-- Main Glass Container -->
                    <div
                        class="bg-white dark:bg-glass-dark dark:glass-morphism rounded-xl overflow-hidden border border-black/5 dark:border-white/10 shadow-xl">
                        <!-- Tabs -->
                        <div class="flex border-b border-black/5 dark:border-white/10 px-6">
                            <a href="/user/sync-requests?tab=received"
                                class="py-4 border-b-2 <%= activeTab === 'received' ? 'border-primary text-primary' : 'border-transparent text-slate-500' %> font-bold text-sm px-4">
                                Received <span class="ml-1 bg-primary/20 text-[10px] py-0.5 px-2 rounded-full">
                                    <%= receivedRequests.length %>
                                </span>
                            </a>
                            <a href="/user/sync-requests?tab=sent"
                                class="py-4 border-b-2 <%= activeTab === 'sent' ? 'border-primary text-primary' : 'border-transparent text-slate-500' %> font-bold text-sm px-8 transition-colors">
                                Sent
                            </a>
                        </div>
                        <!-- Request List -->
                        <div class="divide-y divide-black/5 dark:divide-white/5">
    <% if(activeTab === 'received') { %>
        <% if(receivedRequests.length > 0) { %>
            <% for(let Request of receivedRequests) { %>
                <div class="p-6 flex items-center justify-between hover:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4">
                        <img class="h-14 w-14 rounded-full object-cover" src="<%= Request.sender.profilePic.url %>" />
                        <div>
                            <h4 class="font-bold text-white"><%= Request.sender.name %></h4>
                            <p class="text-sm text-slate-400">Wants to sync with you</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <form action="/user/accept-sync/<%=Request._id%>" method="POST"><button class="h-9 px-4 bg-primary text-white text-sm font-bold rounded-xl">Accept</button></form>
                        <form action="/user/reject-sync/<%=Request._id%>" method="POST"><button class="h-9 px-4 border border-white/10 text-slate-400 text-sm font-bold rounded-xl">Decline</button></form>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="p-10 text-center text-slate-500">No incoming requests.</div>
        <% } %>

    <% } else if(activeTab === 'sent') { %>
        <% if(sentRequests && sentRequests.length > 0) { %>
            <% for(let Request of sentRequests) { %>
                <% if (Request.receiver) { %> 
                <div class="p-6 flex items-center justify-between hover:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4">
                        <img class="h-14 w-14 rounded-full object-cover" src="<%= Request.receiver.profilePic.url %>" />
                        <div>
                            <h4 class="font-bold text-white"><%= Request.receiver.name %></h4>
                            <p class="text-sm text-slate-400">Waiting for classmate's response...</p>
                        </div>
                    </div>
                    <form action="/user/revoke/<%=Request._id%>?_method=DELETE" method="POST">
                        <button class="h-9 px-4 border border-red-500/30 text-red-500 hover:bg-red-500 hover:text-white text-sm font-bold rounded-xl transition-all">Cancel Request</button>
                    </form>
                </div>
                <% } %>
            <% } %>
        <% } else { %>
            <div class="p-10 text-center text-slate-500">You haven't sent any requests yet.</div>
        <% } %>

    <% } else if(activeTab === 'network') { %>
        <% if(myNetwork && myNetwork.length > 0) { %>
            <% for(let friend of myNetwork) { %>
                <div class="p-6 flex items-center justify-between hover:bg-white/5 transition-colors">
                    <div class="flex items-center gap-4">
                        <img class="h-14 w-14 rounded-full object-cover border-2 border-primary/20" src="<%= friend.profilePic.url %>" />
                        <div>
                            <h4 class="font-bold text-white"><%= friend.name %></h4>
                            <p class="text-xs text-green-500 font-medium">Synced Connection</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <a href="/chat?chatId=<%= friend._id %>" class="h-9 px-4 bg-white/5 hover:bg-white/10 text-white text-sm font-bold rounded-xl flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">chat</span> Message
                        </a>
                        <form action="/user/unsync/<%= friend._id %>?_method=DELETE" method="POST" onsubmit="return confirm('Remove connection?')">
                            <button type="submit" class="h-9 px-4 border border-red-500/20 text-red-500/50 hover:bg-red-500 hover:text-white text-sm font-bold rounded-xl flex items-center gap-2">
                                <span class="material-symbols-outlined text-sm">person_remove</span>
                            </button>
                        </form>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="p-10 text-center text-slate-500">Your network is empty. Start syncing!</div>
        <% } %>
    <% } %>
</div>
                </section>
                <!-- Right Sidebar: Loop Suggestions -->
                <aside class="lg:col-span-3 space-y-6">
                    <div
                        class="bg-white dark:bg-card-dark rounded-xl p-5 shadow-sm border border-black/5 dark:border-white/5">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold dark:text-white">Loop Suggestions</h3>
                            <span
                                class="material-symbols-outlined text-slate-500 cursor-pointer hover:text-primary">info</span>
                        </div>
                        <div class="space-y-4">

                            <!-- Suggestion 1 -->
                            <% for(let suggestion of loopSuggestions) { %>
                                <a href="/user/<%=suggestion._id%>" class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="h-10 w-10 rounded-full overflow-hidden">
                                            <img class="h-full w-full object-cover"
                                                data-alt="Ishaan Varma profile photo"
                                                src="<%=suggestion.profilePic.url%>" />
                                        </div>
                                        <div class="min-w-0">
                                            <p class="text-sm font-bold text-white truncate">
                                                <%=suggestion.name%>
                                            </p>
                                            <p class="text-[11px] text-slate-400 truncate">IIT Delhi â€¢ AI/ML</p>
                                        </div>
                                    </div>
                                    <form action="/user/sync/<%=suggestion._id%>" method="POST">
                                        <button
                                            class="p-1.5 rounded-lg bg-primary/10 text-primary hover:bg-primary hover:text-white transition-all">
                                            <span class="material-symbols-outlined text-lg">add</span>
                                        </button>
                                    </form>
                                </a>
                                <% } %>

                        </div>
                        <button
                            class="w-full mt-3 py-2 text-xs font-bold text-slate-400 hover:text-primary transition-colors border-t border-white/5 pt-4">
                            See more suggestions
                        </button>
                    </div>
                </aside>
            </div>
        </main>
    </body>

    </html>