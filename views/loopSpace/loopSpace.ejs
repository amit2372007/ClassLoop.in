<% layout("/layout/boilerplate.ejs") -%>

    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>LoopSpace Community Dashboard</title>

        <script id="tailwind-config">
            tailwind.config = {
                darkMode: "class",
                theme: {
                    extend: {
                        colors: {
                            "primary": "#5248e5",
                            "background-light": "#f6f6f8",
                            "background-dark": "#0f0e1a",
                            "slate-card": "#1c1b2e",
                            "accent-emerald": "#10b981",
                            "accent-amber": "#f59e0b",
                        },
                        fontFamily: {
                            "display": ["Inter", "sans-serif"]
                        },
                        borderRadius: {
                            "DEFAULT": "0.25rem",
                            "lg": "0.5rem",
                            "xl": "0.75rem",
                            "full": "9999px"
                        },
                    },
                },
            }
        </script>
        <style>
            .glass {
                background: rgba(28, 27, 46, 0.7);
                backdrop-filter: blur(12px);
                border: 1px solid rgba(255, 255, 255, 0.05);
            }

            .material-symbols-outlined {
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }

            .active-nav {
                background: rgba(82, 72, 229, 0.15);
                border-left: 3px solid #5248e5;
            }
        </style>
    </head>


    <body>

        <div class="max-w-[1600px] mx-auto flex gap-6 px-3 py-3">
            <!-- Left Sidebar Navigation -->
            <aside class="w-80 flex flex-col gap-8 shrink-0 sticky top-3 h-[calc(100vh-24px)] overflow-y-auto custom-scrollbar">
                <nav class="flex flex-col gap-1">
                    <p class="px-4 text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Main Menu</p>

                    <a class="flex items-center gap-3 px-4 py-2.5 rounded-lg transition-colors <%= activeTab === 'Feed' ? 'active-nav text-primary font-bold' : 'hover:bg-white/5 text-slate-400 font-medium' %>"
                        href="?tab=Feed">
                        <span class="material-symbols-outlined text-[20px]">dynamic_feed</span>
                        <span class="text-sm">Feed</span>
                    </a>

                    <a class="flex items-center gap-3 px-4 py-2.5 rounded-lg transition-colors <%= activeTab === 'loopSpaceChats' ? 'active-nav text-primary font-bold' : 'hover:bg-white/5 text-slate-400 font-medium' %>"
                        href="?tab=loopSpaceChats">
                        <span class="material-symbols-outlined text-[20px]">chat_bubble_outline</span>
                        <span class="text-sm">
                            <%= loopSpace.class.className %>-<%= loopSpace.class.section %> Chats
                        </span>
                    </a>

                    <a class="flex items-center gap-3 px-4 py-2.5 rounded-lg transition-colors <%= activeTab === 'Application' ? 'active-nav text-primary font-bold' : 'hover:bg-white/5 text-slate-400 font-medium' %>"
                        href="?tab=Application">
                        <span class="material-symbols-outlined text-[20px]">campaign</span>
                        <span class="text-sm">Application</span>
                    </a>

                    <a class="flex items-center gap-3 px-4 py-2.5 rounded-lg transition-colors <%= activeTab === 'Polls' ? 'active-nav text-primary font-bold' : 'hover:bg-white/5 text-slate-400 font-medium' %>"
                        href="?tab=Polls">
                        <span class="material-symbols-outlined text-[20px]">poll</span>
                        <span class="text-sm">Polls</span>
                    </a>

                    <a class="flex items-center gap-3 px-4 py-2.5 rounded-lg transition-colors <%= activeTab === 'Resources' ? 'active-nav text-primary font-bold' : 'hover:bg-white/5 text-slate-400 font-medium' %>"
                        href="?tab=Resources">
                        <span class="material-symbols-outlined text-[20px]">folder_open</span>
                        <span class="text-sm">Shared Resources</span>
                    </a>
                </nav>

            </aside>


            <!-- Center Feed -->
            <% if (activeTab==="Feed" ) { %>
                <main class="flex-1 max-w-3xl space-y-6">
                    <%- include("../includes/loopSpace/Feed.ejs") %>
                </main>
                <aside class="w-80 space-y-6">
                    <!-- DoubtBin Widget -->
                     <% if(classDoubts.length>0){ %>
                    <div class="glass rounded-xl p-5">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm text-white font-bold flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">psychology_alt</span>
                                DoubtBin
                            </h3>
                            <button class="text-xs text-primary font-bold hover:underline">View All</button>
                        </div>
                        <div class="space-y-3">
                            <% for(let doubt of classDoubts) { 
                                if(!doubt.isResolved){ %>
                            <div class="p-3 rounded-lg bg-white/5 border border-white/5 group relative overflow-hidden">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-xs text-slate-300 font-medium leading-tight"><%=doubt.title%></p>
                                    <span
                                        class="material-symbols-outlined text-accent-emerald text-lg">check_circle</span>
                                </div>
                                <p class="text-[10px] text-accent-emerald font-bold">Posted by Mr. <%=doubt.author.name%></p>
                            </div>
                            <% }} %>
                            
                        </div>
                        <button
                            class="w-full mt-4 py-2 border border-dashed border-white/10 rounded-lg text-xs text-slate-500 hover:border-primary/50 hover:text-primary transition-all">
                            + Post a Doubt
                        </button>
                    </div>
                    <% } %>
                    <!-- Poll Widget -->
                    <% if(!currUser) { %>
                    <div class="glass rounded-xl p-5">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-sm text-white font-bold flex items-center gap-2">
                                <span class="material-symbols-outlined text-primary">bar_chart</span>
                                Live Poll
                            </h3>
                            <span class="flex h-2 w-2 rounded-full bg-red-500 animate-pulse"></span>
                        </div>
                        <p class="text-xs font-semibold mb-4 text-slate-200">Best time for extra Math class?</p>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-[10px] mb-1 font-medium">
                                    <span class="text-white">4 PM - 5 PM</span>
                                    <span class="text-primary">45%</span>
                                </div>
                                <div class="w-full bg-white/5 rounded-full h-2 overflow-hidden">
                                    <div class="bg-primary h-full rounded-full" style="width: 45%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[10px] mb-1 font-medium">
                                    <span class="text-white">6 PM - 7 PM</span>
                                    <span>30%</span>
                                </div>
                                <div class="w-full bg-white/5 rounded-full h-2 overflow-hidden">
                                    <div class="bg-white/10 h-full rounded-full" style="width: 30%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[10px] mb-1 font-medium">
                                    <span class="text-white">8 PM - 9 PM</span>
                                    <span>25%</span>
                                </div>
                                <div class="w-full bg-white/5 rounded-full h-2 overflow-hidden">
                                    <div class="bg-white/10 h-full rounded-full" style="width: 25%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="text-[10px] text-center text-slate-500 mt-4">18 votes casted â€¢ Ending in 3h</p>
                    </div>
                    <%}%>
                    
                </aside>

                <% } else if(activeTab==="loopSpaceChats" ) { %>
                    <div
                        class="flex w-full h-[90vh] overflow-hidden rounded-2xl border border-white/5 bg-background-dark/20 mx-auto">
                        <%- include("../includes/loopSpace/loopSpaceChats.ejs") %>
                    </div>
                    <% } else if(activeTab === 'Resources') {%>
                        <%- include("../includes/loopSpace/sharedResources.ejs") %>
                   <% } else if(activeTab === 'Application') {  %>
                        <%- include("../includes/loopSpace/Application.ejs") %>
                    <% } %>
        </div>
    </body>