<%- layout("/layout/boilerplate") %>

<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />

<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    primary: "#4848e5",
                    "background-light": "#f6f6f8",
                    "background-dark": "#0F172A",
                },
                fontFamily: {
                    display: ["Space Grotesk", "sans-serif"],
                    mono: ["Fira Code", "monospace"],
                },
            },
        },
    };
</script>

<style>
    .glitch-wrapper { position: relative; display: inline-block; }
    
    /* Glitch Animation Keyframes */
    @keyframes glitch-anim-1 {
        0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 1px); }
        20% { clip-path: inset(60% 0 10% 0); transform: translate(2px, -1px); }
        40% { clip-path: inset(40% 0 50% 0); transform: translate(-2px, 2px); }
        60% { clip-path: inset(80% 0 5% 0); transform: translate(2px, -2px); }
        80% { clip-path: inset(10% 0 60% 0); transform: translate(-1px, 1px); }
        100% { clip-path: inset(30% 0 70% 0); transform: translate(1px, -1px); }
    }

    .glitch-text::before, .glitch-text::after {
        content: attr(data-text);
        position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
    }
    .glitch-text::before {
        color: #ff00c1; animation: glitch-anim-1 2.5s infinite linear alternate-reverse; opacity: 0.75;
    }
    .glitch-text::after {
        color: #00fff9; animation: glitch-anim-1 3s infinite linear alternate; opacity: 0.75;
    }

    .scanline-overlay {
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
        background-size: 100% 4px; pointer-events: none;
    }
    
    .terminal-glow { box-shadow: 0 0 20px rgba(72, 72, 229, 0.15); }
    .button-glow:hover { box-shadow: 0 0 25px rgba(72, 72, 229, 0.5); }
    
    /* Custom Scrollbar for Stack Trace */
    .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.2); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.3); }
</style>

<body class="bg-background-light dark:bg-background-dark font-display text-slate-200 min-h-screen flex flex-col items-center justify-center overflow-hidden selection:bg-primary selection:text-white">

    <div class="fixed inset-0 z-0 opacity-20 pointer-events-none">
        <div class="absolute inset-0 bg-[radial-gradient(#4848e5_1px,transparent_1px)] [background-size:40px_40px]"></div>
    </div>
    <div class="fixed inset-0 z-10 scanline-overlay opacity-30 pointer-events-none"></div>

    <main class="relative z-20 container mx-auto px-6 flex flex-col items-center text-center max-w-4xl">
        
        <% const status = typeof statusCode !== 'undefined' ? statusCode : 500; %>
        <div class="glitch-wrapper mb-2 select-none">
            <h1 class="glitch-text text-[8rem] md:text-[12rem] font-bold leading-none tracking-tighter text-white/90" 
                data-text="<%= status %>">
                <%= status %>
            </h1>
        </div>

        <div class="mb-8">
            <h2 class="text-2xl md:text-4xl font-bold uppercase tracking-widest text-white mb-2">
                <% if(status === 404) { %>
                    Page Not Found
                <% } else if (status === 403 || status === 401) { %>
                    Access Denied
                <% } else if (status === 500) { %>
                    System Failure
                <% } else { %>
                    Something Went Wrong
                <% } %>
            </h2>
            <div class="h-1 w-24 bg-primary mx-auto rounded-full shadow-[0_0_10px_#4848e5]"></div>
        </div>

        <div class="w-full bg-black/80 border border-white/10 rounded-lg overflow-hidden terminal-glow mb-10 text-left font-mono backdrop-blur-sm">
            
            <div class="flex items-center justify-between px-4 py-2 border-b border-white/10 bg-white/5">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 rounded-full bg-red-500/80"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500/80"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500/80"></div>
                    <span class="text-xs text-slate-500 ml-2 uppercase tracking-tighter font-semibold">Error Log â€” <%= new Date().toLocaleTimeString() %></span>
                </div>
                <button onclick="copyError()" class="text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                    <span class="material-symbols-outlined text-[14px]">content_copy</span>
                    <span>Copy</span>
                </button>
            </div>

            <div class="p-6 space-y-3 text-sm md:text-base overflow-hidden relative">
                <p class="text-green-400 font-bold">
                    <span class="opacity-50 select-none mr-2">$</span>initiating diagnosis...
                </p>
                
                <p class="text-red-400 break-words" id="error-message">
                    <span class="opacity-50 select-none mr-2">&gt;</span>Critical Error: <%= message %>
                </p>

                <% if (process.env.NODE_ENV !== 'production' && err.stack) { %>
                    <div class="mt-4 p-4 bg-white/5 rounded border border-white/5 text-slate-400 text-xs overflow-x-auto custom-scrollbar whitespace-pre-wrap leading-relaxed">
                        <span class="text-yellow-500/80 block mb-1">// Stack Trace (Dev Mode Only)</span>
                        <%= err.stack %>
                    </div>
                <% } else { %>
                     <p class="text-slate-500 italic text-xs">
                        <span class="opacity-50 select-none mr-2">&gt;</span>[Detailed stack trace hidden in production]
                    </p>
                <% } %>

                <p class="text-blue-400 animate-pulse mt-4">
                    <span class="opacity-50 select-none mr-2">&gt;</span>Awaiting user input_<span class="inline-block w-2 h-4 bg-blue-400 ml-1"></span>
                </p>
            </div>
        </div>

        <div class="flex flex-col md:flex-row items-center gap-4 md:gap-6 w-full md:w-auto">
            
            <button onclick="window.location.reload()" 
                class="group relative w-full md:w-auto px-8 py-4 bg-primary text-white font-bold rounded-lg transition-all duration-300 button-glow flex items-center justify-center space-x-3 overflow-hidden cursor-pointer">
                <span class="relative z-10 uppercase tracking-wider text-sm">Retry Connection</span>
                <span class="material-symbols-outlined relative z-10 group-hover:rotate-180 transition-transform duration-500">refresh</span>
                <div class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
            </button>

            <a href="/" 
                class="w-full md:w-auto px-6 py-4 text-slate-400 hover:text-white transition-colors duration-200 border border-transparent hover:border-white/10 rounded-lg text-sm font-medium tracking-wide flex items-center justify-center gap-2">
                <span class="material-symbols-outlined text-lg">arrow_back</span>
                Return to Dashboard
            </a>
        </div>

        <div class="mt-16 flex flex-col items-center text-[10px] text-slate-600 uppercase tracking-[0.2em] space-y-2">
            <span>Protocol: Secure_Route_v2.4</span>
            <div class="flex items-center space-x-4">
                <span>Err_Code: 0x<%= status %></span>
                <span>|</span>
                <span>Node: ClassLoop_Main</span>
            </div>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 p-8 opacity-[0.03] pointer-events-none hidden lg:block select-none">
        <div class="text-[12rem] font-bold text-white leading-none">ERR</div>
    </div>
    <div class="fixed top-0 right-0 p-8 opacity-[0.03] pointer-events-none hidden lg:block select-none">
        <div class="text-[12rem] font-bold text-white leading-none rotate-180"><%= status %></div>
    </div>

    <script>
        function copyError() {
            const errorText = document.getElementById('error-message').innerText;
            navigator.clipboard.writeText(errorText).then(() => {
                const btn = document.querySelector('button[onclick="copyError()"] span:last-child');
                const originalText = btn.innerText;
                btn.innerText = "Copied!";
                setTimeout(() => btn.innerText = originalText, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }
    </script>
</body>